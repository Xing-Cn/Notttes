# ASM 汇编语言
*部分基础知识*

### 核心寄存器

| 寄存器 | 位数 | 主要用途 | 比喻 |
|--------|------|----------|------|
| **EAX** | 32位 | 主要计算结果 | 主工作台 |
| **EBX** | 32位 | 存放数据地址 | 临时货架 |
| **ECX** | 32位 | 循环计数器 | 计数器 |
| **EDX** | 32位 | 辅助计算 | 副工作台 |

> 注 : 去掉E就是16位(AX, BX, CX, DX)

---

### 必备指令表

#### 数据传输类

| 指令 | 格式 | 功能 | 示例 | 相当于C语言 |
|------|------|------|------|------------|
| **MOV** | `MOV dst, src` | 数据传送 | `MOV AX, 5` | `ax = 5;` |
| **XCHG** | `XCHG op1, op2` | 数据交换 | `XCHG AX, BX` | `swap(ax, bx);` |
| **LEA** | `LEA reg, mem` | 取地址(偏移量) | `LEA SI, [BX]` | `si = &bx;` |

##### 算术运算类

| 指令 | 格式 | 功能 | 示例 | 说明 |
|------|------|------|------|------|
| **ADD** | `ADD dst, src` | 加法 | `ADD AX, BX` | `ax += bx;` |
| **SUB** | `SUB dst, src` | 减法 | `SUB AX, 3` | `ax -= 3;` |
| **INC** | `INC dst` | 加1 | `INC CX` | `cx++;` |
| **DEC** | `DEC dst` | 减1 | `DEC DX` | `dx--;` |
| **MUL** | `MUL src` | 无符号乘 | `MUL BX` | `ax *= bx;` |
| **DIV** | `DIV src` | 无符号除 | `DIV BL` | `ax /= bl;` |

#### 逻辑运算类

| 指令 | 格式 | 功能 | 示例 | 说明 |
|------|------|------|------|------|
| **AND** | `AND dst, src` | 逻辑与 | `AND AL, 0xF0` | 保留高4位 |
| **OR** | `OR dst, src` | 逻辑或 | `OR AL, 0x0F` | 置位低4位 |
| **XOR** | `XOR dst, src` | 逻辑异或 | `XOR AL, 0xFF` | 取反(与全1异或) |
| **NOT** | `NOT dst` | 逻辑非 | `NOT AX` | 按位取反 |
| **TEST** | `TEST op1, op2` | 测试 | `TEST AL, 1` | 检查奇偶 |

> TEST 检查最低位

### 移位指令类

| 指令 | 格式 | 功能 | 示例 | 效果 |
|------|------|------|------|------|
| **SHL/SAL** | `SHL dst, cnt` | 左移 | `SHL AL, 1` | `×2` |
| **SHR** | `SHR dst, cnt` | 逻辑右移 | `SHR AL, 1` | `/2`(无符号) |
| **SAR** | `SAR dst, cnt` | 算术右移 | `SAR AL, 1` | `/2`(有符号) |

### 流程控制类

| 指令 | 格式 | 功能 | 条件 |
|------|------|------|------|
| **JMP** | `JMP label` | 无条件跳转 | 无 |
| **JE/JZ** | `JE label` | 相等/为零跳 | ZF=1 |
| **JNE/JNZ** | `JNE label` | 不等/非零跳 | ZF=0 |
| **CALL** | `CALL func` | 调用函数 | 无 |
| **RET** | `RET` | 从函数返回 | 无 |

---

### 寻址方式

| 类型 | 格式 | 示例 | 说明 |
|------|------|------|------|
| 立即寻址 | `立即数` | `MOV AX, 1234h` | 直接给数 |
| 寄存器寻址 | `寄存器` | `MOV AX, BX` | 寄存器间传 |
| 直接寻址 | `[地址]` | `MOV AX, [1234h]` | 直接给地址 |
| 寄存器间接 | `[寄存器]` | `MOV AX, [BX]` | 地址在寄存器 |
| 相对寻址 | `[reg+偏移]` | `MOV AX, [BX+5]` | 基址+偏移 |

---

### 常用中断(INT 21h)

| AH | 功能 | 参数 | 返回值 |
|----|------|------|--------|
| 01h | 键盘输入(有回显) | 无 | AL=字符 |
| 02h | 显示字符 | DL=字符 | 无 |
| 09h | 显示字符串 | DS:DX=字符串地址 | 无 |
| 0Ah | 输入字符串 | DS:DX=缓冲区 | 无 |
| 4Ch | 程序终止 | AL=返回码 | 无 |

---

### CTF逆向常见模式

#### 简单加密模式
```assembly
; 异或加密
MOV AL, [SI]    ; 取字符
XOR AL, 0x55    ; 加密
MOV [DI], AL    ; 存储
```
**解密**：`Python: bytes(b ^ 0x55 for b in data)`

#### 移位加密
```assembly
; 左移加密
SHL AL, 2       ; 左移2位
ADD AL, 0x10    ; 再加0x10
```
**解密**：先减0x10，再右移2位

#### 循环校验
```assembly
check:
    MOV AL, [input]     ; 取输入
    ADD AL, key         ; 加密钥
    CMP AL, [correct]   ; 比较
    JNE fail            ; 不相等失败
    INC input           ; 下一字符
    LOOP check          ; 继续
```

---

### 补充

#### 寄存器状态判断

| 指令 | 检查标志 | 含义 |
|------|----------|------|
| `CMP A, B` | ZF=1 | A == B |
| `CMP A, B` | ZF=0 | A != B |
| `CMP A, B` | SF≠OF | A < B（有符号） |
| `CMP A, B` | CF=1 | A < B（无符号） |

#### 常见算法特征

| 算法 | 识别特征 |
|------|----------|
| TEA | 0x9E3779B9常量, 32轮循环 |
| XOR | 单一XOR指令循环 |
| Base64 | 查表转换, '/','+'结尾 |

#### 其他

- **MOV方向** : `MOV A, B` 是 `B → A`
- **JMP家族** : J开头都是跳转，看后缀知条件
- **内存访问** : `[]` 表示去内存取数
- **异或特性** : `A XOR B XOR B = A`（可逆）
- **移位边界** : 移出位丢失，移入位补0

---
