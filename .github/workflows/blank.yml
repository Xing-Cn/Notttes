name: È¢ù„ÅÆËá™Âä®ÂåñÁ®ãÂ∫èÂ£πÂè∑~

on:
  push:
    branches: [ main ]

permissions:
  contents: write

jobs:
  check-and-update:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ëé∑Âèñ‰ªìÂ∫ì‰ª£Á†Å
      uses: actions/checkout@v4
      
    - name: Êõ¥Êñ∞READMEÁªüËÆ°
      run: |
        # Ëé∑ÂèñÁªüËÆ°‰ø°ÊÅØ
        NOTE_COUNT=$(find . -name "*.md" | wc -l)
        
        # Âà†Èô§ÊóßÁöÑÁªüËÆ°Âå∫Âùó(Â¶ÇÊûúÂ≠òÂú®)
        if grep -q :"### üöÄÂÆûÊó∂ÁªüËÆ°" README.md; then
          echo "Âà†Èô§ÊóßÁöÑÁªüËÆ°Âå∫Âùó..."
          # ‰ªé *### üöÄÂÆûÊó∂ÁªüËÆ°* Âà†Èô§Âà∞ *auto updata* ‰πãÈó¥ÁöÑÊâÄÊúâÂÜÖÂÆπ
          sed -i '/### üöÄÂÆûÊó∂ÁªüËÆ°/,/^*auto updata*/d' README.md
        fi
        
        # Âú® README.md ‰∏≠Ê∑ªÂä†Êñ∞ÁöÑÁªüËÆ°‰ø°ÊÅØ
        echo "" >> README.md
        echo "### üöÄÂÆûÊó∂ÁªüËÆ°" >> README.md
        echo "> ÊúÄÂêéÂêåÊ≠•: $(date '+%Y-%m-%d %H:%M')" >> README.md
        echo "" >> README.md
        echo "- Á¨îËÆ∞ÊÄªÊï∞: $NOTE_COUNT ÁØá" >> README.md
        echo "- Ê£ÄÊü•Áä∂ÊÄÅ: ‚úÖËøêË°åÊ≠£Â∏∏" >> README.md
        echo "" >> README.md
        echo "*auto updata*" >> README.md
        
    - name: Êèê‰∫§Êõ¥Êîπ
      run: |
        git config --local user.email "a138196861120@163.com"
        git config --local user.name "Xing-Cn"
        git add README.md
        git commit -m "updata README.md" || exit 0
        git push
