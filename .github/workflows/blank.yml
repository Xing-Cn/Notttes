name: åŠ³èµ„çš„ç¬¬ä¸€ä¸ªè‡ªåŠ¨åŒ–~

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  say-hello:
    runs-on: ubuntu-latest

    steps:
    - name : è·å–ä»“åº“ä»£ç 
      uses : actions/checkout@v4
      
    - name : æ£€æŸ¥
      run : |
        echo "ğŸ‰ ç¬”è®°åº“æ£€æŸ¥å¼€å§‹..."
        echo "ğŸ“ æ–‡ä»¶ç»“æ„ï¼š"
        find . -maxdepth 2 -type d | grep -v ".git" | sort
        echo "ğŸ“ ç¬”è®°ç»Ÿè®¡ï¼š"
        find . -name "*.md" | wc -l | xargs echo "æ€»Markdownæ–‡ä»¶:"

    - name : æ›´æ–°README
      run : |
        echo "ğŸ“Š æ­£åœ¨æ›´æ–°READMEæ˜¾ç¤º..."
        
        # ç»Ÿè®¡ä¿¡æ¯
        NOTE_COUNT=$(find . -name "*.md" | wc -l)
        LAST_UPDATE=$(git log -1 --format="%Y-%m-%d %H:%M")
        LAST_COMMIT=$(git log -1 --format="%s")
        
        # æ£€æŸ¥æ˜¯å¦å·²æœ‰ç»Ÿè®¡åŒºå—ï¼Œå¦‚æœæœ‰å°±æ›´æ–°ï¼Œæ²¡æœ‰å°±åˆ›å»º
        if grep -q "## ğŸš€ å®æ—¶ç»Ÿè®¡" README.md; then
          echo "ğŸ“ æ›´æ–°ç°æœ‰ç»Ÿè®¡åŒºå—..."
          sed -i "s/ç¬”è®°æ€»æ•°: .*/ç¬”è®°æ€»æ•°: $NOTE_COUNT ç¯‡/" README.md
          sed -i "s/æœ€ååŒæ­¥: .*/æœ€ååŒæ­¥: $LAST_UPDATE/" README.md
          sed -i "s/æœ€è¿‘æ›´æ–°: .*/æœ€è¿‘æ›´æ–°: $LAST_COMMIT/" README.md
        else
          echo "ğŸ“ åˆ›å»ºæ–°çš„ç»Ÿè®¡åŒºå—..."
          cat >> README.md << EOF

> æœ€ååŒæ­¥: $LAST_UPDATE

- ç¬”è®°æ€»æ•°: $NOTE_COUNT ç¯‡
- æœ€è¿‘æ›´æ–°: $LAST_COMMIT
- æ£€æŸ¥çŠ¶æ€: âœ… è¿è¡Œæ­£å¸¸

*æ­¤ç»Ÿè®¡ç”± GitHub Action è‡ªåŠ¨æ›´æ–°*
EOF
        fi
        
        echo "âœ… README æ›´æ–°å®Œæˆï¼"

    - name: æäº¤æ›´æ”¹
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md
        git diff --staged --quiet || git commit -m "ğŸ“Š æ›´æ–°å®æ—¶ç»Ÿè®¡ä¿¡æ¯"
        git push
