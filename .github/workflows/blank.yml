name: ç¬”è®°åº“æ™ºèƒ½æ£€æŸ¥

on:
  push:
    branches: [ main ]

jobs:
  check-and-update:
    runs-on: ubuntu-latest
    
    steps:
    - name: è·å–ä»“åº“ä»£ç 
      uses: actions/checkout@v4
      
    - name: åŸºç¡€æ£€æŸ¥
      run: |
        echo "ğŸ‰ ç¬”è®°åº“æ£€æŸ¥å¼€å§‹..."
        echo "ğŸ“ æ–‡ä»¶ç»“æ„ï¼š"
        find . -maxdepth 2 -type d | grep -v ".git" | sort
        echo "ğŸ“ ç¬”è®°ç»Ÿè®¡ï¼š"
        find . -name "*.md" | wc -l | xargs echo "æ€»Markdownæ–‡ä»¶:"
        
    - name: æ›´æ–°READMEç»Ÿè®¡
      run: |
        echo "ğŸ“Š æ­£åœ¨æ›´æ–°READMEæ˜¾ç¤º..."
        
        NOTE_COUNT=$(find . -name "*.md" | wc -l)
        LAST_UPDATE=$(git log -1 --format="%Y-%m-%d %H:%M")
        LAST_COMMIT=$(git log -1 --format="%s")
        
        # åˆ›å»ºç»Ÿè®¡å†…å®¹
        cat > /tmp/stats.md << EOF
        
## ğŸš€ å®æ—¶ç»Ÿè®¡
> æœ€ååŒæ­¥: $LAST_UPDATE

- ç¬”è®°æ€»æ•°: $NOTE_COUNT ç¯‡
- æœ€è¿‘æ›´æ–°: $LAST_COMMIT
- æ£€æŸ¥çŠ¶æ€: âœ… è¿è¡Œæ­£å¸¸

*æ­¤ç»Ÿè®¡ç”± GitHub Action è‡ªåŠ¨æ›´æ–°*
EOF
        
        # åˆ é™¤æ—§çš„ç»Ÿè®¡åŒºå—ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
        if grep -q "## ğŸš€ å®æ—¶ç»Ÿè®¡" README.md; then
          echo "åˆ é™¤æ—§ç»Ÿè®¡åŒºå—..."
          sed -i '/## ğŸš€ å®æ—¶ç»Ÿè®¡/,/*æ­¤ç»Ÿè®¡ç”± GitHub Action è‡ªåŠ¨æ›´æ–°*/d' README.md
        fi
        
        # æ·»åŠ æ–°ç»Ÿè®¡åŒºå—
        cat /tmp/stats.md >> README.md
        echo "âœ… README æ›´æ–°å®Œæˆï¼"
        
    - name: æäº¤æ›´æ”¹
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add README.md
        git diff --staged --quiet || git commit -m "ğŸ“Š æ›´æ–°å®æ—¶ç»Ÿè®¡"
        git push
